<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Andreas Reich">
    <title>Interaktionseffekte verstehen - Vertiefung Datenauswertung</title>

    <style>
        /* === UNIVERSITY OF HOHENHEIM STYLE VARIABLES === */
        :root {
            --uni-blue: #003366;
            /* The deep academic blue */
            --uni-blue-light: #004488;
            --uni-orange: #d73a0a;
            /* The accent color */
            --uni-gray-bg: #f4f4f4;
            --text-color: #333;
            --white: #ffffff;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        /* === RESET & TYPOGRAPHY === */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--uni-gray-bg);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* === HEADER === */
        header {
            background-color: var(--uni-blue);
            color: var(--white);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 5px solid var(--uni-orange);
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }

        header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* === MAIN CONTAINER === */
        .container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 1rem;
            flex: 1;
        }

        /* === SECTIONS === */
        section {
            background: var(--white);
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 5px solid transparent;
            /* Ready for accent highlighting */
        }

        h2 {
            color: var(--uni-blue);
            border-bottom: 2px solid var(--uni-gray-bg);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        h3 {
            color: var(--uni-blue-light);
            margin-bottom: 1rem;
        }

        /* === PLACEHOLDER BLOCKS (TODO STYLES) === */
        /* These styles allow us to visualize where components will go */
        .todo-block {
            border: 2px dashed #ccc;
            background-color: #fcfcfc;
            padding: 2rem;
            border-radius: var(--border-radius);
            text-align: center;
            color: #888;
            margin-bottom: 1rem;
            position: relative;
            transition: var(--transition);
        }

        .todo-block:hover {
            border-color: var(--uni-orange);
            color: var(--uni-orange);
            background-color: #fffaf8;
        }

        .todo-label {
            font-weight: bold;
            display: block;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .todo-desc {
            font-size: 0.9rem;
            font-style: italic;
        }

        /* === FOOTER === */
        footer {
            text-align: center;
            padding: 2rem;
            background-color: var(--uni-blue);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: auto;
        }

        /* === RESPONSIVE UTILS === */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .container {
                margin: 1rem auto;
            }

            section {
                padding: 1.5rem;
            }
        }

        /* === ENGINE GRID LAYOUT === */
        .engine-grid {
            display: grid;
            grid-template-columns: 1.5fr 1.5fr;
            /* SVG takes more space */
            gap: 1.5rem;
        }

        @media (max-width: 850px) {
            .engine-grid {
                grid-template-columns: 1fr;
            }
        }

        .viz-container,
        .controls-container {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 1rem;
        }

        .box-title {
            margin-top: 0;
            font-size: 1rem;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .instruction-text {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 1rem;
            font-style: italic;
        }

        /* === DROPDOWN === */
        .scenario-dropdown {
            padding: 0.5rem;
            font-size: 1rem;
            border: 2px solid var(--uni-blue);
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }

        /* === SVG STYLES === */
        .svg-wrapper {
            width: 100%;
            /* Keep aspect ratio container */
            position: relative;
        }

        svg text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            fill: #444;
        }

        /* === SLIDER CONTROLS (MODERN STANDARD) === */
        .slider-group-wrapper {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .slider-cluster {
            flex: 1;
            text-align: center;
        }

        .cluster-label {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--uni-blue);
            font-size: 0.9rem;
        }

        .sliders-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            height: 180px;
            margin-top: 40px;
        }

        .vertical-divider {
            width: 1px;
            background: #ddd;
            margin: 0 10px;
            align-self: stretch;
        }

        .slider-vertical-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            /* Align value at bottom */
            height: 100%;
            width: 40px;
        }

        .slider-track {
            height: 130px;
            /* Slider height */
            width: 30px;
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }

        /* Modern Cross-Browser Vertical Slider */
        .slider-vertical-box input[type=range] {
            writing-mode: vertical-lr;
            direction: rtl;
            -webkit-appearance: slider-vertical;
            width: 100%;
            height: 100%;
            margin: 0;
            cursor: pointer;
        }
        .val-display {
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .slider-label {
            margin-top: 2px;
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .blue-text {
            color: var(--uni-blue);
        }

        .orange-text {
            color: var(--uni-orange);
        }

        /* === STATS TABLE === */
        .stats-box table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .stats-box th,
        .stats-box td {
            border: 1px solid #eee;
            padding: 6px;
            text-align: left;
        }

        .stats-box th {
            background-color: #f9f9f9;
        }

        /* === DECISION TREE STYLES === */
        .tree-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            padding: 1rem;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            width: 100%;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tree-node {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            width: 300px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .question-node {
            border-top: 5px solid var(--uni-blue);
        }

        .result-node {
            border-top: 5px solid #28a745;
            background-color: #f0fff4;
        }

        .ordinal-bg {
            border-top-color: var(--uni-orange);
            background-color: #fff8f0;
        }

        .disordinal-bg {
            border-top-color: #dc3545;
            background-color: #fff0f0;
        }

        .node-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .node-text {
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .tree-btn {
            background: var(--uni-blue);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 0 5px;
            transition: transform 0.2s;
            margin-top: 15px;
        }

        .tree-btn:hover {
            transform: scale(1.05);
            background: var(--uni-blue-light);
        }

        .tree-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback States */
        .feedback-msg {
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            min-height: 1.2em;
        }

        .feedback-correct {
            color: #28a745;
        }

        .feedback-wrong {
            color: #dc3545;
        }

        .tree-connector {
            height: 30px;
            width: 2px;
            background-color: #ccc;
            margin: 5px 0;
            display: none;
            /* Shown dynamically */
        }

        .reset-btn {
            background: transparent;
            border: 1px solid #999;
            color: #666;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .reset-btn:hover {
            background: #eee;
        }

        /* === SOLUTION BOX STYLES === */
        .solution-box {
            background-color: #f0f7ff;
            border: 1px solid #cce5ff;
            border-left: 5px solid var(--uni-blue);
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .solution-header {
            background-color: #e6f0ff;
            padding: 0.8rem 1.5rem;
            font-weight: bold;
            color: var(--uni-blue);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #cce5ff;
        }

        .solution-content {
            padding: 1.5rem;
            color: #333;
            font-size: 1rem;
            line-height: 1.8;
        }

        .solution-content p {
            margin-bottom: 1rem;
        }

        .solution-highlight {
            background-color: rgba(255, 193, 7, 0.2);
            padding: 0 4px;
            border-radius: 2px;
            font-weight: 600;
        }

        /* === STEP 5: MOBILE POLISH === */
        @media (max-width: 768px) {
            .engine-grid {
                grid-template-columns: 1fr;
                /* Stack chart and sliders */
            }

            .tree-level {
                flex-direction: column;
                /* Stack tree branches */
                align-items: center;
                gap: 1rem !important;
                /* Force gap */
            }

            .tree-connector {
                display: none !important;
                /* Hide connectors on mobile to avoid mess */
            }

            .tree-branch {
                width: 100%;
                display: flex;
                justify-content: center;
            }

/* === SPSS TABLE STYLE (UPDATED) === */
        .spss-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Arial', sans-serif;
            font-size: 11px;
            color: #000;
            margin-top: 1rem;
            background-color: #fff;
            border: 1px solid #777;
        }

        .spss-table th {
            text-align: left;
            border-bottom: 1px solid #000;
            padding: 6px 8px;
            background-color: #e0e0e0; /* Header Grau */
            font-weight: normal;
        }

        .spss-table td {
            padding: 4px 8px;
            border-bottom: 1px solid #ddd;
            border-right: 1px solid #ddd; /* Vertikale Linien SPSS-like */
        }

        /* Erste Spalte Grau & Fett */
        .spss-table td:first-child {
            background-color: #f4f4f4;
            font-weight: bold;
            color: #333;
            border-right: 1px solid #ccc;
        }

        .spss-table tr:last-child td {
            border-bottom: 2px solid #000;
        }

        .spss-highlight {
            background-color: #ffffd9 !important; /* Markierung √ºberlagert Grau nicht komplett */
        }
        
        /* Highlight f√ºr die erste Spalte in der Highlight-Zeile */
        .spss-highlight td:first-child {
            background-color: #fcf8e3 !important; 
        }

        .spss-val { 
            text-align: right; /* Zahlen rechtsb√ºndig wie in SPSS */
            font-variant-numeric: tabular-nums; 
        }
        }
    </style>
</head>

<body>

    <!-- 1. HEADER -->
    <header>
        <div class="header-content">
            <!-- Placeholder for Logo if needed -->
            <h1>Vertiefung Datenauswertung</h1>
            <p class="subtitle">Modul: Mehrfaktorielle Varianzanalyse & Interaktionseffekte</p>
        </div>
    </header>

    <div class="container">
        <main>

            <!-- 2. INTRODUCTORY THEORY -->
            <section id="intro">
                <h2>Was sind Interaktionseffekte?</h2>
                <p>
                    In einer mehrfaktoriellen Varianzanalyse (ANOVA) betrachten wir nicht nur die isolierten Effekte
                    einzelner Faktoren (Haupteffekte), sondern auch deren Zusammenspiel.
                </p>
                <p>
                    Ein <strong>Interaktionseffekt</strong> liegt vor, wenn die Wirkung eines Faktors (z. B.
                    <em>Lernumgebung</em>)
                    davon abh√§ngt, welche Auspr√§gung ein anderer Faktor (z. B. <em>Aufgabenschwierigkeit</em>) hat.
                    Ist die Interaktion signifikant, d√ºrfen wir die Haupteffekte oft nicht mehr "blind" interpretieren.
                </p>
                <div
                    style="background-color: #e7f3fe; border-left: 4px solid var(--uni-blue); padding: 1rem; margin-top: 1rem;">
                    <strong>Kernfrage:</strong> "Kommt es darauf an?" ‚Äì Wenn die Antwort "Ja" lautet, haben Sie
                    vermutlich eine Interaktion.
                </div>
            </section>

            <div id="scenario-info" style="background: #e7f3fe; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid var(--uni-blue);">
                <h3 style="margin:0 0 10px 0; font-size:1.1rem;">Forschungsfrage</h3>
                <p id="scenario-intro" style="margin:0; font-size: 0.95rem;"></p>
                <div id="scenario-hypotheses" style="margin-top:10px; font-size: 0.85rem; color:#555;"></div>
            </div>
            <!-- ENDE EINF√úGUNG -->

            <section id="engine-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Das Interaktions-Labor</h2>
                    <!-- Scenario Selector -->
                    <select id="scenario-selector" class="scenario-dropdown">
                        <option value="" disabled selected>-- Bitte Szenario w√§hlen --</option>
                        <!-- Options will be injected by JS later -->
                    </select>
                </div>

                <div class="engine-grid">
                    <!-- LEFT: Visualization (SVG) -->
                    <div class="viz-container">
                        <h4 class="box-title">Interaktionsdiagramm</h4>
                        <div class="svg-wrapper">
                            <svg id="interaction-plot" viewBox="0 0 500 350" preserveAspectRatio="xMidYMid meet">
                                <!-- Grid Lines (Background) -->
                                <g id="grid-lines" stroke="#e0e0e0" stroke-width="1"></g>

                                <!-- Axes -->
                                <line x1="60" y1="300" x2="480" y2="300" stroke="#333" stroke-width="2" />
                                <!-- X Axis -->
                                <line x1="60" y1="300" x2="60" y2="20" stroke="#333" stroke-width="2" /> <!-- Y Axis -->

                                <!-- Axis Labels -->
                                <text x="270" y="340" text-anchor="middle" font-weight="bold" id="label-x-axis">Faktor A
                                    (UV1)</text>
                                <text x="20" y="160" text-anchor="middle" font-weight="bold"
                                    transform="rotate(-90 20,160)" id="label-y-axis">AV (Messwert)</text>

                                <!-- X-Axis Ticks Labels (Factor A Levels) -->
                                <text x="165" y="320" text-anchor="middle" id="label-a1">A1</text>
                                <text x="375" y="320" text-anchor="middle" id="label-a2">A2</text>

                                <!-- The Data Lines -->
                                <path id="line-b1" d="" fill="none" stroke="var(--uni-blue)" stroke-width="3" />
                                <circle id="point-a1b1" cx="165" cy="0" r="6" fill="var(--uni-blue)" />
                                <circle id="point-a2b1" cx="375" cy="0" r="6" fill="var(--uni-blue)" />

                                <path id="line-b2" d="" fill="none" stroke="var(--uni-orange)" stroke-width="3"
                                    stroke-dasharray="5,5" />
                                <circle id="point-a1b2" cx="165" cy="0" r="6" fill="var(--white)"
                                    stroke="var(--uni-orange)" stroke-width="3" />
                                <circle id="point-a2b2" cx="375" cy="0" r="6" fill="var(--white)"
                                    stroke="var(--uni-orange)" stroke-width="3" />

                                <!-- Legend -->
                                <g transform="translate(80, 0)">
                                    <rect width="200" height="50" fill="white" stroke="#ccc" rx="5" />
                                    <!-- Legend Item 1 -->
                                    <line x1="10" y1="15" x2="30" y2="15" stroke="var(--uni-blue)" stroke-width="3" />
                                    <text x="35" y="19" font-size="12" id="legend-b1">B1</text>
                                    <!-- Legend Item 2 -->
                                    <line x1="10" y1="35" x2="30" y2="35" stroke="var(--uni-orange)" stroke-width="3"
                                        stroke-dasharray="5,5" />
                                    <text x="35" y="39" font-size="12" id="legend-b2">B2</text>
                                </g>
                            </svg>
                        </div>
                    </div>

                    <!-- RIGHT: Controls (Sliders) -->
                    <div class="controls-container">
                        <h4 class="box-title">Daten-Simulation (Mittelwerte)</h4>
                        <p class="instruction-text">Verschieben Sie die Regler, um die Mittelwerte der 4 Gruppen zu
                            ver√§ndern.</p>

                        <div class="slider-group-wrapper">

                            <!-- Group A1 -->
                            <div class="slider-cluster">
                                <div class="cluster-label" id="group-label-a1">Bedingung A1</div>
                                <div class="sliders-row">
                                    <!-- Slider A1-B1 -->
                                    <div class="slider-vertical-box">
                                        <div class="slider-track">
                                            <input type="range" id="input-a1b1" min="0" max="100" value="50"
                                                >
                                        </div>
                                        <span class="val-display blue-text" id="val-a1b1">50</span>
                                        <span class="slider-label" id="label-input-a1b1">B1</span>
                                    </div>
                                    <!-- Slider A1-B2 -->
                                    <div class="slider-vertical-box">
                                        <div class="slider-track">
                                            <input type="range" id="input-a1b2" min="0" max="100" value="50"
                                                >
                                        </div>
                                        <span class="val-display orange-text" id="val-a1b2">50</span>
                                        <span class="slider-label" id="label-input-a1b2">B2</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Divider -->
                            <div class="vertical-divider"></div>

                            <!-- Group A2 -->
                            <div class="slider-cluster">
                                <div class="cluster-label" id="group-label-a2">Bedingung A2</div>
                                <div class="sliders-row">
                                    <!-- Slider A2-B1 -->
                                    <div class="slider-vertical-box">
                                        <div class="slider-track">
                                            <input type="range" id="input-a2b1" min="0" max="100" value="50"
                                                >
                                        </div>
                                        <span class="val-display blue-text" id="val-a2b1">50</span>
                                        <span class="slider-label" id="label-input-a2b1">B1</span>
                                    </div>
                                    <!-- Slider A2-B2 -->
                                    <div class="slider-vertical-box">
                                        <div class="slider-track">
                                            <input type="range" id="input-a2b2" min="0" max="100" value="50"
                                                >
                                        </div>
                                        <span class="val-display orange-text" id="val-a2b2">50</span>
                                        <span class="slider-label" id="label-input-a2b2">B2</span>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Mini Stats Table -->
                        <div class="stats-box" id="spss-container">
                            <!-- SPSS Table will be injected here via JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. THE DECISION TREE (TODO: STEP 3) -->
            <section id="tree-section">
                <h2>Entscheidungsbaum: Pr√ºfen Sie Ihr Wissen</h2>
                <p>Gehen Sie den Pfad Schritt f√ºr Schritt durch. Klicken Sie auf die Antwort, die Ihrer Meinung nach auf
                    das aktuelle Szenario (oben) zutrifft.</p>

                <div class="tree-container">

                    <!-- LEVEL 1: SIGNIFICANCE -->
                    <div class="tree-level" id="lvl-1">
                        <div class="tree-node question-node">
                            <div class="node-title">Schritt 1</div>
                            <div class="node-text">Ist der Interaktionseffekt (A x B) signifikant?</div>
                            <div class="node-controls">
                                <button class="tree-btn" onclick="decisionTree.check(1, true)">Ja</button>
                                <button class="tree-btn" onclick="decisionTree.check(1, false)">Nein</button>
                            </div>
                            <div class="feedback-msg" id="feedback-1"></div>
                        </div>
                    </div>

                    <!-- CONNECTOR LINES (Dynamic) -->
                    <div class="tree-connector" id="conn-1"></div>

                    <!-- LEVEL 2: BRANCHING -->
                    <div class="tree-level" id="lvl-2" style="display:none; gap: 2rem;">

                        <!-- BRANCH LEFT (NO INTERACTION) -->
                        <div class="tree-branch" id="branch-no" style="display:none;">
                            <div class="tree-node result-node">
                                <div class="node-title">Ergebnis</div>
                                <div class="node-text">
                                    Keine Interaktion.<br>
                                    <strong>Die Haupteffekte d√ºrfen global interpretiert werden.</strong>
                                </div>
                            </div>
                        </div>

                        <!-- BRANCH RIGHT (YES INTERACTION) -->
                        <div class="tree-branch" id="branch-yes" style="display:none;">
                            <div class="tree-node question-node">
                                <div class="node-title">Schritt 2</div>
                                <div class="node-text">
                                    Betrachten Sie das Diagramm.<br>
                                    Wie verhalten sich die Linien zueinander?
                                </div>
                                <div class="node-controls" style="flex-direction: column; gap: 10px;">
                                    <!-- Passing 'true' for Ordinal/Parallel, 'false' for Disordinal/Crossing -->
                                    <button class="tree-btn" onclick="decisionTree.check(2, true)">
                                        Linien verlaufen gleichsinnig<br><span style="font-size:0.7em">(Rangreihe bleibt
                                            gleich)</span>
                                    </button>
                                    <button class="tree-btn" onclick="decisionTree.check(2, false)">
                                        Linien kreuzen sich<br><span style="font-size:0.7em">(Rangreihe dreht sich
                                            um)</span>
                                    </button>
                                </div>
                                <div class="feedback-msg" id="feedback-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- CONNECTOR LINES LEVEL 2 -->
                    <div class="tree-connector" id="conn-2"></div>

                    <!-- LEVEL 3: FINAL CONCLUSION (For Interaction Path) -->
                    <div class="tree-level" id="lvl-3" style="display:none; gap: 2rem;">

                        <!-- ORDINAL RESULT -->
                        <div class="tree-branch" id="res-ordinal" style="display:none;">
                            <div class="tree-node result-node ordinal-bg">
                                <div class="node-title">Ordinale Interaktion</div>
                                <div class="node-text">
                                    Die Effekte gehen in die gleiche Richtung, sind aber unterschiedlich stark.<br>
                                    <strong>Haupteffekte sind (mit Vorsicht) interpretierbar.</strong>
                                </div>
                            </div>
                        </div>

                        <!-- DISORDINAL RESULT -->
                        <div class="tree-branch" id="res-disordinal" style="display:none;">
                            <div class="tree-node result-node disordinal-bg">
                                <div class="node-title">Disordinale Interaktion</div>
                                <div class="node-text">
                                    Die Effekte kehren sich um (Crossover).<br>
                                    <strong>Haupteffekte sind NICHT global interpretierbar!</strong>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="reset-btn" onclick="decisionTree.reset()">Baum zur√ºcksetzen</button>
                </div>
            </section>


            <section id="interpretation-section">
                <h2>Ergebnisformulierung (Klausur-Modus)</h2>
                <p>Wenn Sie den Entscheidungsbaum oben erfolgreich durchlaufen haben, erscheint hier die prototypische
                    Formulierung der Ergebnisse.</p>

                <!-- The Solution Container (Initially Hidden) -->
                <div id="solution-container" class="solution-box" style="display:none;">
                    <div class="solution-header">
                        <span class="icon">üéì</span> Musterl√∂sung
                    </div>
                    <div id="solution-text" class="solution-content">
                        <!-- Text will be injected here by JS -->
                    </div>
                </div>

                <!-- Fallback Message -->
                <div id="solution-placeholder" class="todo-block"
                    style="border: 1px solid #eee; background: #fafafa; color: #aaa;">
                    <span class="todo-desc">Bitte l√∂sen Sie erst den Entscheidungsbaum, um die L√∂sung
                        freizuschalten.</span>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <p>&copy; <span id="year">2025</span> Andreas Reich | Universit√§t Hohenheim</p>
    </footer>

    <!-- 6. JAVASCRIPT SHELL -->
    <script>
        // === 1. DATEN: SZENARIEN MIT KONTEXT ===
        const SCENARIOS = [
            {
                id: "no_interaction",
                name: "Szenario 1: Pflanzenwachstum (Keine Interaktion)",
                intro: "Ein Biologe untersucht den Einfluss von D√ºnger und Licht auf Maispflanzen. Erwartung: Beide Faktoren wirken positiv, aber unabh√§ngig voneinander.",
                hypotheses: {
                    h1: "H1: Es wird ein Interaktionseffekt angenommen (Wirkung von D√ºnger h√§ngt vom Licht ab)."
                },
                labels: { uv1: "D√ºnger (A)", uv2: "Licht (B)", av: "Wuchsh√∂he (cm)", a1: "Wenig", a2: "Viel", b1: "Dunkel", b2: "Hell" },
                presets: { a1b1: 20, a1b2: 50, a2b1: 40, a2b2: 70 }
            },
            {
                id: "ordinal",
                name: "Szenario 2: Klinische Therapie (Ordinale Interaktion)",
                intro: "Vergleich einer neuen Verhaltenstherapie (VT) mit Standardbehandlung. Forschungsfrage: Hilft die neue Therapie besonders bei schweren F√§llen?",
                hypotheses: {
                    h1: "H1: Die √úberlegenheit der neuen Therapie ist abh√§ngig vom Schweregrad (Interaktion)."
                },
                labels: { uv1: "Therapie (A)", uv2: "Schweregrad (B)", av: "Symptomreduktion", a1: "Standard", a2: "Neu", b1: "Mild", b2: "Schwer" },
                presets: { a1b1: 30, a1b2: 40, a2b1: 45, a2b2: 90 }
            },
            {
                id: "disordinal",
                name: "Szenario 3: Lerntypen (Disordinale Interaktion)",
                intro: "Ein P√§dagoge testet die 'Matching-Hypothese': Visuelle Lerntypen sollten von Bildern profitieren, verbale Lerntypen von Texten.",
                hypotheses: {
                    h1: "H1: Der Lerneffekt der Methode h√§ngt vom Lerntyp ab (Matching-Effekt)."
                },
                labels: { uv1: "Methode (A)", uv2: "Lerntyp (B)", av: "Test-Score (0-100)", a1: "Bild", a2: "Text", b1: "Visuell", b2: "Verbal" },
                presets: { a1b1: 80, a1b2: 30, a2b1: 30, a2b2: 80 }
            },
            {
                id: "hybrid",
                name: "Szenario 4: Sport-Coaching (Hybrid/Kompensation)",
                intro: "Bringt teures Coaching etwas? Hypothese: Talente sind ohnehin gut (Deckeneffekt), aber Anf√§nger profitieren massiv.",
                hypotheses: {
                    h1: "H1: Das Coaching wirkt unterschiedlich stark je nach Talentlevel."
                },
                labels: { uv1: "Training (A)", uv2: "Talent (B)", av: "Leistungspunkte", a1: "Ohne", a2: "Mit", b1: "Niedrig", b2: "Hoch" },
                presets: { a1b1: 20, a1b2: 85, a2b1: 70, a2b2: 90 }
            }
        ];

// === 2. MATHE ENGINE: FAKE-SPSS BERECHNUNG (REALISMUS UPDATE) ===
        class ANOVAEngine {
            constructor() {
                // N=200 Gesamtstichprobe (50 pro Zelle) -> wirkt seri√∂ser
                this.n_per_cell = 50; 
                this.df_effect = 1;
                // df_error = N - k = 200 - 4 = 196
                this.df_error = 196; 
                // Erh√∂hte Varianz f√ºr N=50, damit F nicht sofort explodiert
                this.ms_error = 420.5; 
            }

            calculateP(f) {
                if (f <= 0) return 1.0;
                // Angepasste Approximation f√ºr df error = 196
                if (f < 1) return 0.5 + (1 - f) * 0.5;
                // Bei N=200 wird F schon ab ca. 3.89 signifikant (p<.05)
                if (f > 3.89 && f < 3.95) return 0.049;
                
                // Exponentielle N√§herung
                let p = Math.exp(-0.55 * f);
                
                // Hard limits f√ºr die "sch√∂nen" SPSS Schwellen
                if (f > 12) p = 0.0001; // SPSS zeigt dann .000
                
                // Gl√§ttung f√ºr den √úbergangsbereich
                if (f > 3.89 && f <= 6.7) p = 0.05 - ((f - 3.89) / (6.7 - 3.89) * 0.04);
                if (f > 6.7 && f <= 12) p = 0.01 - ((f - 6.7) / (12 - 6.7) * 0.0099);
                
                return p;
            }

            analyze(means) {
                // Rauschen hinzuf√ºgen ("Jitter"), damit Ergebnisse nicht "glatt" sind
                // Wir nutzen einen Pseudo-Randomizer basierend auf den Werten, damit
                // das Ergebnis beim gleichen Slider-Wert gleich bleibt (kein Flackern).
                const jitter = (val) => {
                    const seed = val * 1.3; 
                    const noise = Math.sin(seed) * 2.5; // +/- 2.5 Punkte Rauschen
                    return val + noise;
                };

                const m = {
                    a1b1: jitter(means.a1b1),
                    a1b2: jitter(means.a1b2),
                    a2b1: jitter(means.a2b1),
                    a2b2: jitter(means.a2b2)
                };
                
                // 1. Mittelwerte
                const mean_a1 = (m.a1b1 + m.a1b2) / 2;
                const mean_a2 = (m.a2b1 + m.a2b2) / 2;
                const mean_b1 = (m.a1b1 + m.a2b1) / 2;
                const mean_b2 = (m.a1b2 + m.a2b2) / 2;
                const grand_mean = (mean_a1 + mean_a2) / 2;

                // 2. Sum of Squares (SS)
                const ss_a = (2 * this.n_per_cell) * (Math.pow(mean_a1 - grand_mean, 2) + Math.pow(mean_a2 - grand_mean, 2));
                const ss_b = (2 * this.n_per_cell) * (Math.pow(mean_b1 - grand_mean, 2) + Math.pow(mean_b2 - grand_mean, 2));

                const ss_cells = this.n_per_cell * (
                    Math.pow(m.a1b1 - grand_mean, 2) + 
                    Math.pow(m.a1b2 - grand_mean, 2) + 
                    Math.pow(m.a2b1 - grand_mean, 2) + 
                    Math.pow(m.a2b2 - grand_mean, 2)
                );
                
                let ss_int = ss_cells - ss_a - ss_b;
                if (ss_int < 0) ss_int = 0;

                // Error Term (Simuliert leich variierend mit den Means f√ºr Realismus)
                // Hohe Werte streuen in Realit√§t oft mehr -> Heteroskedastizit√§t simulieren (leicht)
                const variance_factor = 1 + (grand_mean / 500); 
                const ss_error = (this.ms_error * variance_factor) * this.df_error;
                
                const ss_total = ss_cells + ss_error;
                const ss_model = ss_a + ss_b + ss_int;

                // 3. Ergebnisobjekt bauen
                return {
                    model: this.getStats(ss_model, 3, ss_error), 
                    factorA: this.getStats(ss_a, 1, ss_error),
                    factorB: this.getStats(ss_b, 1, ss_error),
                    interaction: this.getStats(ss_int, 1, ss_error),
                    error: { ss: ss_error, df: this.df_error, ms: (ss_error/this.df_error) },
                    total: { ss: ss_total + (grand_mean*grand_mean*200), df: 200 },
                    total_corr: { ss: ss_total, df: 199 }
                };
            }

            getStats(ss, df, ss_error_term) {
                const ms = ss / df;
                // MS Error ist hier dynamisch aus ss_error_term abgeleitet
                const ms_err = ss_error_term / this.df_error;
                const f = ms / ms_err;
                const p = this.calculateP(f);
                const eta = ss / (ss + ss_error_term);

                return { ss, df, ms, f, p, eta, sig: p < 0.05 };
            }
        }
        // === GLOBAL STATE ===
        let currentState = {
            scenario: null,
            means: { a1b1: 0, a1b2: 0, a2b1: 0, a2b2: 0 },
            stats: null, // Wird von ANOVAEngine gef√ºllt
            interactionSignificant: false,
            isOrdinal: true
        };

        // === CLASS 3: SCENARIO ENGINE (UI & Logic) ===
        class ScenarioEngine {
            constructor() {
                this.anova = new ANOVAEngine(); // Mathe Modul laden

                this.dom = {
                    svg: document.getElementById('interaction-plot'),
                    selector: document.getElementById('scenario-selector'),
                    spssContainer: document.getElementById('spss-container'),
                    introText: document.getElementById('scenario-intro'),
                    hypoText: document.getElementById('scenario-hypotheses'),
                    inputs: {
                        a1b1: document.getElementById('input-a1b1'), a1b2: document.getElementById('input-a1b2'),
                        a2b1: document.getElementById('input-a2b1'), a2b2: document.getElementById('input-a2b2')
                    },
                    displays: {
                        a1b1: document.getElementById('val-a1b1'), a1b2: document.getElementById('val-a1b2'),
                        a2b1: document.getElementById('val-a2b1'), a2b2: document.getElementById('val-a2b2')
                    },
                    labels: {
                        xaxis: document.getElementById('label-x-axis'), yaxis: document.getElementById('label-y-axis'),
                        a1: document.getElementById('label-a1'), a2: document.getElementById('label-a2'),
                        lb1: document.getElementById('legend-b1'), lb2: document.getElementById('legend-b2'),
                        ga1: document.getElementById('group-label-a1'), ga2: document.getElementById('group-label-a2'),
                        l_a1b1: document.getElementById('label-input-a1b1'), l_a1b2: document.getElementById('label-input-a1b2'),
                        l_a2b1: document.getElementById('label-input-a2b1'), l_a2b2: document.getElementById('label-input-a2b2')
                    },
                    viz: {
                        lineB1: document.getElementById('line-b1'), lineB2: document.getElementById('line-b2'),
                        pA1B1: document.getElementById('point-a1b1'), pA1B2: document.getElementById('point-a1b2'),
                        pA2B1: document.getElementById('point-a2b1'), pA2B2: document.getElementById('point-a2b2')
                    }
                };
                this.init();
            }

            init() {
                SCENARIOS.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s.id;
                    opt.textContent = s.name;
                    this.dom.selector.appendChild(opt);
                });

                this.dom.selector.addEventListener('change', (e) => this.loadScenario(e.target.value));

                Object.keys(this.dom.inputs).forEach(k => {
                    this.dom.inputs[k].addEventListener('input', (e) => {
                        currentState.means[k] = parseInt(e.target.value);
                        this.dom.displays[k].textContent = currentState.means[k];
                        this.updatePlot();
                    });
                });

                this.loadScenario(SCENARIOS[0].id);
            }

            loadScenario(id) {
                const s = SCENARIOS.find(sc => sc.id === id);
                if (!s) return;

                // Labels Update
                const l = this.dom.labels;
                l.xaxis.textContent = s.labels.uv1; l.yaxis.textContent = s.labels.av;
                l.a1.textContent = s.labels.a1; l.a2.textContent = s.labels.a2;
                l.lb1.textContent = s.labels.b1; l.lb2.textContent = s.labels.b2;
                l.ga1.textContent = s.labels.a1; l.ga2.textContent = s.labels.a2;
                l.l_a1b1.textContent = s.labels.b1; l.l_a2b1.textContent = s.labels.b1;
                l.l_a1b2.textContent = s.labels.b2; l.l_a2b2.textContent = s.labels.b2;

                // Content Update
                this.dom.introText.textContent = s.intro;
                this.dom.hypoText.textContent = s.hypotheses.h1;

                currentState.scenario = id;
                currentState.means = { ...s.presets };

                Object.keys(currentState.means).forEach(k => {
                    this.dom.inputs[k].value = currentState.means[k];
                    this.dom.displays[k].textContent = currentState.means[k];
                });

                this.updatePlot();
            }

            mapY(val) { return 300 - (val / 100) * (300 - 20); }

            updatePlot() {
                const m = currentState.means;

                // 1. Plot Drawing
                const yA1B1 = this.mapY(m.a1b1); const yA1B2 = this.mapY(m.a1b2);
                const yA2B1 = this.mapY(m.a2b1); const yA2B2 = this.mapY(m.a2b2);
                const xA1 = 165; const xA2 = 375;

                this.dom.viz.pA1B1.setAttribute('cy', yA1B1); this.dom.viz.pA1B2.setAttribute('cy', yA1B2);
                this.dom.viz.pA2B1.setAttribute('cy', yA2B1); this.dom.viz.pA2B2.setAttribute('cy', yA2B2);
                this.dom.viz.lineB1.setAttribute('d', `M ${xA1} ${yA1B1} L ${xA2} ${yA2B1}`);
                this.dom.viz.lineB2.setAttribute('d', `M ${xA1} ${yA1B2} L ${xA2} ${yA2B2}`);

                // 2. Calculate Stats via ANOVA Engine
                const stats = this.anova.analyze(m);
                currentState.stats = stats;
                currentState.interactionSignificant = stats.interaction.sig;

                // 3. Ordinality Check (Crossing)
                const diffA1 = m.a1b1 - m.a1b2;
                const diffA2 = m.a2b1 - m.a2b2;
                let isDisordinal = false;
                // Check if lines cross significantly
                if ((diffA1 > 5 && diffA2 < -5) || (diffA1 < -5 && diffA2 > 5)) isDisordinal = true;
                currentState.isOrdinal = !isDisordinal;

                // 4. Render SPSS Table
                this.renderSPSSTable(stats);

                // 5. Reset Tree (User must check new data)
                if (window.decisionTree) window.decisionTree.reset();
            }

            fmt(num) { 
                // Tausenderpunkt, Komma f√ºr Dezimal, 3 Nachkommastellen
                return num.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 3}); 
            }
            
            fmtP(p) { 
                // SPSS Konvention: .000 statt 0,000 bei sehr kleinen Werten
                // Aber wir nutzen deutsches Komma
                if(p < 0.001) return "< ,001";
                // F√ºhrende Null weglassen ist US-Style, in DE oft 0,123.
                // SPSS Output DE macht meistens 0,123 oder ,123. Wir nehmen Standard DE.
                return p.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 3});
            }

            renderSPSSTable(s) {
                const scen = SCENARIOS.find(x => x.id === currentState.scenario);
                const uv1 = scen ? scen.labels.uv1.split('(')[0].trim() : "Faktor A";
                const uv2 = scen ? scen.labels.uv2.split('(')[0].trim() : "Faktor B";

                const html = `
                <table class="spss-table">
                    <thead>
                        <tr>
                            <th>Quelle</th>
                            <th>Typ III Quadratsumme</th>
                            <th>df</th>
                            <th>Mittel der Quadrate</th>
                            <th>F</th>
                            <th>Sig.</th>
                            <th>Partielles Eta-Quadrat</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Korrigiertes Modell</td>
                            <td class="spss-val">${this.fmt(s.model.ss)}</td>
                            <td class="spss-val">${s.model.df}</td>
                            <td class="spss-val">${this.fmt(s.model.ms)}</td>
                            <td class="spss-val">${this.fmt(s.model.f)}</td>
                            <td class="spss-val">${this.fmtP(s.model.p)}</td>
                            <td class="spss-val">${this.fmt(s.model.eta)}</td>
                        </tr>
                        <tr>
                            <td>Konstanter Term</td>
                            <td class="spss-val">---</td><td class="spss-val">1</td><td>---</td><td>---</td><td>---</td><td>---</td>
                        </tr>
                        <tr>
                            <td>${uv1} (A)</td>
                            <td class="spss-val">${this.fmt(s.factorA.ss)}</td>
                            <td class="spss-val">1</td>
                            <td class="spss-val">${this.fmt(s.factorA.ms)}</td>
                            <td class="spss-val">${this.fmt(s.factorA.f)}</td>
                            <td class="spss-val">${this.fmtP(s.factorA.p)}</td>
                            <td class="spss-val">${this.fmt(s.factorA.eta)}</td>
                        </tr>
                        <tr>
                            <td>${uv2} (B)</td>
                            <td class="spss-val">${this.fmt(s.factorB.ss)}</td>
                            <td class="spss-val">1</td>
                            <td class="spss-val">${this.fmt(s.factorB.ms)}</td>
                            <td class="spss-val">${this.fmt(s.factorB.f)}</td>
                            <td class="spss-val">${this.fmtP(s.factorB.p)}</td>
                            <td class="spss-val">${this.fmt(s.factorB.eta)}</td>
                        </tr>
                        <tr class="spss-highlight">
                            <td>${uv1} * ${uv2}</td>
                            <td class="spss-val">${this.fmt(s.interaction.ss)}</td>
                            <td class="spss-val">1</td>
                            <td class="spss-val">${this.fmt(s.interaction.ms)}</td>
                            <td class="spss-val">${this.fmt(s.interaction.f)}</td>
                            <td class="spss-val">${this.fmtP(s.interaction.p)}</td>
                            <td class="spss-val">${this.fmt(s.interaction.eta)}</td>
                        </tr>
                        <tr>
                            <td>Fehler</td>
                            <td class="spss-val">${this.fmt(s.error.ss)}</td>
                            <td class="spss-val">${s.error.df}</td>
                            <td class="spss-val">${this.fmt(s.error.ms)}</td>
                            <td></td><td></td><td></td>
                        </tr>
                        <tr>
                            <td>Gesamt</td>
                            <td class="spss-val">${this.fmt(s.total.ss)}</td>
                            <td class="spss-val">${s.total.df}</td>
                            <td></td><td></td><td></td><td></td>
                        </tr>
                        <tr>
                            <td>Korrigierte Gesamtvariation</td>
                            <td class="spss-val">${this.fmt(s.total_corr.ss)}</td>
                            <td class="spss-val">${s.total_corr.df}</td>
                            <td></td><td></td><td></td><td></td>
                        </tr>
                    </tbody>
                </table>
                <div style="font-size: 0.75rem; color:#666; margin-top:5px; text-align:right;">
                    a. R-Quadrat = ${this.fmt(s.model.eta)} (Korrigiertes R-Quadrat = ...)
                </div>
                `;
                
                this.dom.spssContainer.innerHTML = html;
            }
        }

        // === CLASS 4: INTERPRETATION GENERATOR (Exam Text) ===
        class InterpretationGenerator {
            constructor() {
                this.container = document.getElementById('solution-container');
                this.textBox = document.getElementById('solution-text');
                this.placeholder = document.getElementById('solution-placeholder');
            }

            reset() {
                this.container.style.display = 'none';
                this.placeholder.style.display = 'block';
            }

            generate() {
                const s = SCENARIOS.find(x => x.id === currentState.scenario);
                const stats = currentState.stats.interaction;
                const sig = currentState.interactionSignificant;
                const ordinal = currentState.isOrdinal;
                const df1 = stats.df; // Freiheitsgrade Z√§hler (1)

                const df2 = currentState.stats.error.df; // Freiheitsgrade Nenner (Fehler, dynamisch)

                // Formatierungshilfen
                const fVal = stats.f.toFixed(2);
                const pVal = stats.p < 0.001 ? "< .001" : "= " + stats.p.toFixed(3).replace('0.', '.');
                const etaVal = stats.eta.toFixed(3).replace('0.', '.');

                let html = `<p><strong>1. Statistischer Befund (APA):</strong><br>
                Die zweifaktorielle Varianzanalyse ergab eine <span class="solution-highlight">${sig ? "signifikante" : "nicht signifikante"}</span> Interaktion 
                zwischen den Faktoren <em>${s.labels.uv1}</em> und <em>${s.labels.uv2}</em>, 
                <em>F</em>(${df1}, ${df2}) = ${fVal}, <em>p</em> ${pVal}, Œ∑¬≤ = ${etaVal}.<br>
                Damit konnte die Forschungshypothese H1 <strong>${sig ? "best√§tigt" : "nicht best√§tigt"}</strong> werden.</p>`;

                html += `<p><strong>2. Visuelle Inspektion & Art der Interaktion:</strong><br>`;
                if (!sig) {
                    html += `Die Linien im Diagramm verlaufen ann√§hernd <span class="solution-highlight">parallel</span>. 
                    Dies st√ºtzt das Ergebnis, dass keine Interaktion vorliegt. Die Faktoren wirken unabh√§ngig voneinander.`;
                } else {
                    if (ordinal) {
                        html += `Die Linien verlaufen <span class="solution-highlight">nicht parallel</span>, schneiden sich aber nicht (bzw. die Rangreihe der Mittelwerte bleibt erhalten). 
                        Daher liegt eine <strong>ordinale Interaktion</strong> vor.`;
                    } else {
                        html += `Die Linien <span class="solution-highlight">kreuzen sich</span> (Cross-Over-Effekt). Die Rangreihe der Mittelwerte kehrt sich um. 
                        Daher liegt eine <strong>disordinale Interaktion</strong> vor.`;
                    }
                }
                html += `</p>`;

                html += `<p><strong>3. Konsequenz f√ºr die Interpretation:</strong><br>`;
                if (!sig) {
                    html += `Die Haupteffekte von <em>${s.labels.uv1}</em> und <em>${s.labels.uv2}</em> d√ºrfen global interpretiert werden (vorausgesetzt, sie sind signifikant).`;
                } else if (ordinal) {
                    html += `Obwohl eine Interaktion vorliegt, d√ºrfen die Haupteffekte (unter Ber√ºcksichtigung der Interaktion) global interpretiert werden, da die Richtung der Effekte konsistent bleibt.`;
                } else {
                    html += `Aufgrund der disordinalen Interaktion ist eine Interpretation der Haupteffekte <strong>irref√ºhrend und nicht zul√§ssig</strong>! 
                    Es m√ºssen die einfachen Haupteffekte (Simple Main Effects) analysiert werden (d.h. der Effekt von A getrennt f√ºr B1 und B2).`;
                }
                html += `</p>`;

                this.textBox.innerHTML = html;
                this.placeholder.style.display = 'none';
                this.container.style.display = 'block';

                setTimeout(() => {
                    this.container.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Render Latex math if MathJax were loaded (optional)
                }, 100);
            }
        }

        /* === CLASS 5: DECISION TREE (Logic) === */
        class DecisionTree {
            constructor() { this.reset(); }

            reset() {
                document.getElementById('lvl-2').style.display = 'none';
                document.getElementById('lvl-3').style.display = 'none';
                document.getElementById('branch-yes').style.display = 'none';
                document.getElementById('branch-no').style.display = 'none';
                document.getElementById('res-ordinal').style.display = 'none';
                document.getElementById('res-disordinal').style.display = 'none';
                document.querySelectorAll('.feedback-msg').forEach(el => el.textContent = '');
                document.querySelectorAll('.tree-btn').forEach(btn => btn.disabled = false);
                if (window.interpretationGen) window.interpretationGen.reset();
            }

            check(step, userChoice) {
                const feedbackEl = document.getElementById(`feedback-${step}`);

                // STEP 1: Significance Check
                if (step === 1) {
                    const truth = currentState.interactionSignificant;
                    if (userChoice === truth) {
                        this.showFeedback(feedbackEl, true, "Korrekt!");
                        this.disableButtons(1);
                        document.getElementById('lvl-2').style.display = 'flex';

                        if (truth) {
                            document.getElementById('branch-yes').style.display = 'block';
                        } else {
                            document.getElementById('branch-no').style.display = 'block';
                            if (window.interpretationGen) window.interpretationGen.generate();
                        }
                    } else {
                        this.showFeedback(feedbackEl, false, "Falsch. Schauen Sie auf die Zeile 'Faktor A * Faktor B' in der Tabelle. Ist Sig. < .05?");
                    }
                }

                // STEP 2: Ordinal vs Disordinal
                if (step === 2) {
                    const truth = currentState.isOrdinal;
                    if (userChoice === truth) {
                        this.showFeedback(feedbackEl, true, "Richtig!");
                        this.disableButtons(2);
                        document.getElementById('lvl-3').style.display = 'flex';

                        if (truth) document.getElementById('res-ordinal').style.display = 'block';
                        else document.getElementById('res-disordinal').style.display = 'block';

                        if (window.interpretationGen) window.interpretationGen.generate();
                    } else {
                        let msg = truth ? "Falsch. Die Linien schneiden sich nicht wesentlich (Rangreihe bleibt gleich)." : "Falsch. Die Linien kreuzen sich deutlich.";
                        this.showFeedback(feedbackEl, false, msg);
                    }
                }
            }

            showFeedback(el, isCorrect, text) {
                el.textContent = text;
                el.className = isCorrect ? "feedback-msg feedback-correct" : "feedback-msg feedback-wrong";
            }

            disableButtons(step) {
                const btns = document.querySelectorAll(`#lvl-${step} .node-controls button`);
                btns.forEach(b => b.disabled = true);
            }
        }

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('year').textContent = new Date().getFullYear();

            // Order matters:
            window.interpretationGen = new InterpretationGenerator();
            window.decisionTree = new DecisionTree();
            window.engine = new ScenarioEngine(); // Starts logic
        });
    </script>

</body>

</html>